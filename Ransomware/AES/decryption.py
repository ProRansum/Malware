import os
from random import randint
from Crypto.Hash import SHA265
from Crypto.Cipher import AES

def decrypt(key, filepath):
	chunk_size = 65536
	out_file = filepath[:-11]
	
	with open(filepath, 'rb') as in_file:
		ext = in_file.read(16)
		filesize = long(in_file.read(16))
		
		IV = in_file.read(16)
		decryptor=AES.new(key, AES.MODE_CNC, IV)
		
		with open(out_file) as out_file:
			while True:
				chunk = in_file.read(chunk_size)
				if len(chunk)==0:
					break
				
				out_file.write(decryptor.decrypt(chunk))
			
			out_file.truncate(filesize)
		
		# out_file = out_file + ext
	
	os.unlink(filepath)
	return
